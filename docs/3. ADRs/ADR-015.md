# ADR 015 – Versionamento e Evolução das APIs

Data: 21/09/2025  
Autor: Ciro Rezende <cirorezende@gmail.com>

**Item:** Estratégia para versionamento e evolução das APIs REST sem quebrar compatibilidade com clientes existentes.

**Decisão a ser tomada:** Definir como as APIs serão versionadas e evoluídas ao longo do tempo, considerando a necessidade de manter compatibilidade com sistemas integrados e permitir evolução incremental.

**Possibilidades levantadas:**  

- **Versionamento por URL:** `/v1/orders`, `/v2/orders` - Simples, mas prolifera endpoints.
- **Versionamento por Header:** `Accept: application/vnd.api+json;version=1` - Flexível, menos visível.
- **Versionamento por Query Parameter:** `?version=1` - Simples, mas pode ser esquecido.
- **Semantic Versioning:** Seguir padrão semver para mudanças.
- **Backward Compatibility:** Manter compatibilidade sem versionamento explícito.

**Escolha:** Versionamento por URL com Semantic Versioning e estratégia de deprecação gradual.

**Justificativa:**  
Esta abordagem oferece clareza e previsibilidade para evolução das APIs:

**Estrutura de Versionamento:**
- Formato: `/api/v{major}/resource`
- Exemplo: `/api/v1/orders`, `/api/v1/orders/{id}`
- Versionamento apenas para mudanças breaking (major version)
- Mudanças não-breaking mantêm a mesma versão

**Semantic Versioning:**
- **Major (v1 → v2):** Mudanças breaking (remoção de campos, alteração de contratos)
- **Minor:** Adição de funcionalidades compatíveis (novos campos opcionais)
- **Patch:** Correções de bugs sem impacto na interface

**Estratégia de Evolução:**
- **Additive Changes:** Novos campos sempre opcionais e no final do JSON
- **Deprecation Period:** 6 meses de aviso antes de remover versões antigas
- **Parallel Support:** Máximo 2 versões major ativas simultaneamente
- **Documentation:** Changelog detalhado para cada versão

**Headers de Resposta:**
- `API-Version: 1.2.3` - Versão atual da API
- `API-Deprecated: true` - Indica versão depreciada
- `API-Sunset: 2025-12-31` - Data de descontinuação

**Compatibilidade:**
- Campos removidos retornam `null` por período de transição
- Novos campos obrigatórios têm valores padrão sensatos
- Validações mais restritivas são introduzidas gradualmente

**Monitoramento:**
- Métricas de uso por versão de API
- Alertas para uso de versões depreciadas
- Dashboard de adoção de novas versões