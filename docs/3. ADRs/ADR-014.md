# ADR 014 – Estratégia de Testes Automatizados

Data: 21/09/2025  
Autor: Ciro Rezende <cirorezende@gmail.com>

**Item:** Abordagem para testes automatizados que garantam qualidade e confiabilidade do sistema.

**Decisão a ser tomada:** Definir a estratégia de testes que cubra adequadamente as funcionalidades críticas, integrações externas e cenários de falha, considerando a testabilidade mencionada nos requisitos.

**Possibilidades levantadas:**  

- **Testes unitários apenas:** Cobertura básica, não testa integrações.
- **Pirâmide de testes tradicional:** Muitos testes unitários, alguns de integração, poucos E2E.
- **Testes de contrato:** Foco nas interfaces e contratos entre módulos.
- **Testes baseados em propriedades:** Geração automática de casos de teste.
- **Testes de mutação:** Validação da qualidade dos testes existentes.

**Escolha:** Testes unitários apenas.

**Justificativa:**  
Para a primeira versão do sistema, focar exclusivamente em testes unitários oferece o melhor retorno sobre investimento em qualidade:

**Estratégia de Testes Unitários:**
- **Cobertura mínima:** 85% das linhas de código
- **Execução rápida:** Toda a suite deve executar em menos de 30 segundos
- **Isolamento completo:** Todos os testes usam mocks para dependências externas
- **Foco na lógica de negócio:** Algoritmo de seleção de CD, validações de entrada, processamento de pedidos

**Benefícios da abordagem:**
1. **Velocidade de desenvolvimento:** Testes rápidos de escrever e executar, acelerando o ciclo de feedback
2. **Simplicidade:** Menor complexidade de setup e manutenção comparado a testes de integração
3. **Confiabilidade:** Testes determinísticos sem dependências de infraestrutura externa
4. **Cobertura eficaz:** Foco nas regras de negócio críticas onde bugs têm maior impacto
5. **Facilidade de manutenção:** Testes isolados são mais fáceis de debugar e atualizar

**Mocks e Simulações:**
- **API de CDs:** MockWebServer ou WireMock para simular diferentes cenários de resposta
- **Banco de dados:** Mocks dos repositórios para testar lógica sem dependência de PostgreSQL
- **Cache Redis:** Mock das operações de cache para validar comportamento
- **Eventos Kafka:** Mock dos publishers para verificar publicação de eventos

**Cobertura de Cenários Críticos:**
- Processamento de pedidos com diferentes quantidades de itens (1 a 100)
- Seleção de CD baseada em proximidade geográfica
- Tratamento de erros da API externa (timeouts, indisponibilidade)
- Validações de entrada (pedidos inválidos, itens duplicados)
- Cache hit/miss scenarios

Esta abordagem garante qualidade adequada para a primeira versão enquanto mantém a simplicidade e velocidade de desenvolvimento necessárias para entrega rápida de valor.